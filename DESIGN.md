# GrowWithMe 開発設計ドキュメント (v1.0)

## 1. プロジェクト概要
**目的**: ユーザーのプロフィール情報（職業、趣味、家族構成など）を深く理解し、その人に最適化された英語学習コンテンツをAIが生成する「自分専用英語学習アプリ」。

## 2. 実装済み機能体系

### A. プロフィール管理 (Profile Management)
ユーザーのパーソナル情報を詳細に管理する。この情報がすべてのAI生成の「種」となる。
*   **基本情報**: 名前、年齢、性別
*   **背景情報**: 職業、家族構成、出身地
*   **興味・関心**: 趣味、学習したいトピック
*   **コンテキスト**: その他のキーワード（会社名、好きな場所など）
*   **学習設定**: 英語レベル、希望するAIの口調（トーン）
*   **Persistence**: データは `zustand` + `localStorage` で永続化。

### B. 単語学習モード (Vocabulary Features)
単語学習は「管理」と「学習」の2つのフェーズに分ける。

#### B-1. データ管理画面 (Manage UI)
*   **場所**: `/word-list` (実装済み)
*   **機能**: 単語の追加・編集・削除、**AI例文生成** (Create)、および一覧確認。
*   **AI生成仕様**:
    *   **Short Sentence**: 5〜10単語程度の短文。ターゲット単語の意味が明確になるよう生成。
    *   **話題バランシング**: `topicUsageHistory` を利用して多様な文脈を提供。

#### B-2. [未実装] 学習画面 (Study UI / Flashcard)
*   **場所**: `/study/vocab`
*   **機能**: 登録済みの単語を実際に覚えるための画面。
*   **UIイメージ**:
    1.  **出題**: 画面中央に「英単語」と「短い例文」を表示。
    2.  **回答アクション**:
        *   **→ 右 (Easy/分かった)**: 覚えた。「学習ステータス」を進める (`learning` -> `mastered`)。
        *   **← 左 (Hard/もう一回)**: 覚えてない、自信がない。再度出題リストに戻す。
    3.  **リザルト**: 1セット終了後に結果を表示。

### C. [未実装] シャドーイング・モード (Shadowing Features)
シャドーイングも同様に、「素材作り」と「実践」を分ける。

#### C-1. スクリプト管理画面 (Manage UI)
*   **場所**: `/shadowing`
*   **機能**:
    *   **スクリプト生成**: プロフィールを元にした長文（会話形式やプレゼン形式など）を生成・保存する。
    *   **リスト**: 過去に生成したスクリプトの一覧。

#### C-2. 実践画面 (Practice UI / Player)
*   **場所**: `/shadowing/practice/:id`
*   **目的**: 生成されたスクリプトを使って、実際に口を動かすトレーニングを行う。
*   **UI・機能**:
    1.  **Script View**: 英文スクリプトを表示（最初は隠して、タップで表示などのオプションも可）。
    2.  **Audio Player**: (将来的にTTS連携) 音声再生、一時停止、スピード調整。
    3.  **Recorder**: 自分の声を録音し、聞き直す機能。
    4.  **Self-Check**: 「うまく言えたか？」を自分で評価するボタン（Good / Try Again）。

### D. データ保全 (Data Safety)
*   **バックアップ**: JSON形式でのエクスポート/インポート機能。
*   **マージ戦略**: インポート時は ID 重複を考慮し、既存データを壊さないようにマージ（Smart Merge）。

---

## 3. 将来構想: Obsidian連携 (Diary Integration)
**目的**: ユーザーがObsidianで書いている「日記」や「メモ」を読み込み、**「最近あった出来事」や「今の感情」をAI生成のコンテキストとして利用する**。
これにより、「昨日食べたラーメン」や「週末に行った場所」など、極めてタイムリーで個人的な内容を含んだ例文生成が可能になる。

### A. 連携フロー
1.  **Vault読み込み**: ユーザーのObsidian Vault（または指定した日記フォルダ）へのアクセス権を取得する。
2.  **コンテキスト抽出 (Context Extraction)**:
    *   全てのテキストをそのまま送るとトークン量が膨大になるため、直近の日記（例：過去1週間分）から**「重要な出来事」「感情」「キーワード」**を抽出・要約する。
    *   この要約データを、プロフィールの `AdditionalContext` (または専用の `RecentMemory` フィールド) に動的に注入する。
3.  **生成への反映**:
    *   AIプロンプトに「最近の出来事: {extracted_summary}」を含めることで、ユーザーの現在進行形の生活に即した例文を生成させる。

### B. 設計上の考慮点
*   **プライバシー**: 日記という極めてプライベートなデータを扱うため、データの送信先（Gemini API）についてはユーザーの明確な同意と理解が必要。
    *   ※将来的にローカルLLMで要約処理を行えば、外部への送信を最小限に抑えられる可能性がある。
*   **ファイル形式**: ObsidianのMarkdown形式（Frontmatter含む）を正しくパースできるようにする。
*   **更新頻度**: 毎回読み込むと重いため、「日記を同期」ボタン等で明示的にコンテキストを更新する仕組みを検討する。
